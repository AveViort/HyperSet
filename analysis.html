<!DOCTYPE html>
<HTML lang="en-US">
<HEAD>

<base id="myBase" href="https://www.evinet.org/dev/HyperSet/" target="_blank">

<TITLE>Drug screen data - dev version</TITLE>
<LINK href="pics/favicon.ico" rel="shortcut icon">
<meta http-equiv="content-type" content="charset=utf-8">
<META http-equiv="Content-Script-Type" content="application/javascript" >
<LINK href="hyperset.css" type="text/css" rel="stylesheet">
<LINK href="js/jquery-ui-themes-1.11.2/themes/smoothness/jquery-ui.min.css" type="text/css" rel="stylesheet">
<LINK href="js/qTip/jquery.qtip.min.css" type="text/css" rel="stylesheet">
<link href="js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/cytoscape.js-panzoom.css" rel="stylesheet" type="text/css" />
<link href="js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/font-awesome-4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css" />
<link href="//cdn.datatables.net/1.10.4/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">
<link href="//cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css" rel="stylesheet" type="text/css">
<link href="//cdn.datatables.net/plug-ins/3cfcc339e89/integration/jqueryui/dataTables.jqueryui.css" type="text/css">
<link href="//cdn.datatables.net/responsive/1.0.4/css/dataTables.responsive.css" type="text/css">
<script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="js/jquery-ui-1.12.1.custom/jquery-ui.min.js" type="text/javascript"></script>
<script src="js/jquery-ui-contextmenu-master/jquery.ui-contextmenu.min.js" type="text/javascript"></script>  
<script src="js/jquery.form.js" type="text/javascript"></script>  
<script src="js/Cytoscape.js/cytoscape.min.js" type="text/javascript"></script>  
<!--script src="js/cytoscape.js-cxtmenu-master/cytoscape-cxtmenu.js" type="text/javascript"></script-->
<script src="js/cytoscape.js-cxtmenu-master/cytoscape-cxtmenu.js" type="text/javascript"></script>
<script src="js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/cytoscape.js-panzoom.js" type="text/javascript"></script>
<script src="js/overlib.js" type="text/javascript"></script>
<script src="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="//cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.js" type="text/javascript"></script>
<script src="//cdn.datatables.net/responsive/1.0.4/js/dataTables.responsive.js" type="text/javascript"></script>
<script src="js/qTip/jquery.qtip.min.js" type="text/javascript"></script>

<script src="js/Cytoscape.js/cytoscape.js-qtip-master/jquery.cytoscape.js-qtip.js" type="text/javascript"></script>
<script src="js/Cytoscape.js/cytoscape.js-edgehandles.js" type="text/javascript"></script>

<script src="js/HS.js" type="text/javascript" charset="utf-8"></script>
<script src="js/drugs.js" type="text/javascript"></script>

<!--script src="js/HS.js" type="text/javascript" charset="utf-8"></script-->

<style>
li.tab ul {
  display: none;
  margin: 0;
  padding: 0;
  list-style: none;
  border: 1px solid #d5d5d5;
  border-radius: 0 0 3px 3px;
}

li.tab:hover ul li {
  color: #454545;
  margin: 0;
  background-color: #e9e9e9;
  padding: 4px 10px;
  cursor: pointer;
  border-bottom: 1px solid #d5d5d5;
}

li.tab:hover ul li:hover,
li.tab:hover ul li.active {
  background-color: #ffffff;
}

li.tab:hover ul {
  display: block;
  position: absolute;
  top: 100%;
  left: 0;
}

.ui-menu { width: 150px; }
</style>
</HEAD>

<BODY class="ui-state-default ui-corner-all">
<div id="progressbar"></div>
<div id="tabs">
	<ul>
		<li><a href="#tab-home">Home</a></li>
		<li><a href="#tab-signif">Significant results</a></li>
		<li><a href="#tab-lookup">Look up</a></li>
		<li class="tab"><a href="#tab-plot">Plots</a>
			<ul class="tabsubmenu">
				<li onclick = plot("2D")>2D</li>
				<li onclick = plot("3D")>3D</li>
				<li onclick = plot("Box")>Box</li>
			</ul>
		</li>
	</ul>
	<div id="tab-home">This is a home tab</div>
	<div id="tab-signif">
		<table id="select_layout"><tr>
		<td id="selectFeature">
		<select name="screenList" id="screenList" class="ui-helper" style="width: 40ch;" >
		</td>
		<td id="selectCompound>">
		<!--ul name="compoundsList" id="compoundsList"></ul-->
		<select name="compoundsList" id="compoundsList" class="ui-helper" style="width: 40ch;" >
		</td>
		<td>
		<select name="featuresList" id="featuresList" class="ui-helper" style="width: 40ch;" >
		</td>
		<td>
		<button type="submit" id="retrieve-cor-button" name="retrieve-cor-button" onclick = retrieve_correlations() style="width: 150; visibility: visible;">Retrieve correlations</button>
		</td>
		</table>
	</div>
	<div id="tab-lookup"> Tab with content from a.cgi<br>
	</div>
	<div id="tab-plot">This tab shows the most recent plot or (if none) - instruction</div>
</div>

<div id="ssOpener" style="width: 14%; text-align: left;  cursor: pointer;" title="How the four screens measured drug activity?">
	<b>Drug response scales
	<div style="width: 7%; text-align: left;" id="help-0" class="js_ui_help">[?]</div></b>
</div>    
<div id="showScales" >
	<div id="ssAcc"> 
		<h3>ACT</h3>
			<div>
				<p>
				The units stand for 1:300 dilution steps, so that '6' corresponds to the highest dilution.
				Sensitivity to compounds is expressed as IC50 value, so that: 
				<ul><li>
					0 means 'insensitive to compound' and 
				</li><li>
					6 means 'fully sensitive to compound' 
				</li></ul>
				</p>
			</div>
		<h3>CCLE (Barretina et al., 2012), 24 drugs</h3>
			<div>
				<p>
				These authors considered a range of metrics for their analysis, but finally preferred s.c. 'normalized activity areas'. These original units were calculated as areas under compound response curves where higher values corresponded to higher sensitivity so that 0 stood for 'insensitive to compound' and 8 stood for 'full sensitivity'.<br>
				Further, the activity area values were normalized for unequal luminiscence in the assay, and we rendered them normally distributed by log-transformation. Hence finally the values range from 
				<ul><li>
					-3: 'insensitive to compound' to 
				</li><li>
					+2.31: 'maximal sensitivity'
				</li></ul>
				</p>
			</div>
		<h3>CTD2 (Basu et al., 2013), 354 drugs <font  color="red"> <b>(NOTE: INVERTED SCALE!)</b></font ></h3>
			<div>
				<p>
				The authors mainly used area under curve (AUC) for the quantitative analyses - so did we, too.
				In completely insensitive cases the full area under 8 experimental points reached 8, whereas 0 stood for  full sensitivity. Thus, the scale of this screen <b>is INVERTED compared to the three other screens!</b> We did not transform the values further.
				<ul><li>
					0: 'maximal sensitivity', whereas
				</li><li>
					8 or (sometimes) higher: 'insensitive to compound' 
				</li></ul>
				</p>
			</div>
		<h3>CGP (Garnett et al., 2012), 138 drugs</h3>
			<div>
				<p>
				Since these authors used a combination of IC50 and the slope parameter to achieve the most complete description of responses, we decided to use the area under curve (AUC) as a single feature that reflects the both above values. AUC was originally provided in the same table and ranged from 0% (fully sensitive) to 100% (insensitive). To approach the normal distribution, we transformed the values as log(1 - AUC), so that now they range from 
				<ul><li>
					-8.11: 'insensitive to compound' to 
				</li><li>
					0: 'maximal sensitivity'
				</li></ul>
				</p>
			</div>
	</div>
</div>
		
<P style="width:34%;"><a href="https://www.evinet.org/">EviNet.org main site</a></P>
<P style="width:34%;"><a href="http://funcoup2.sbc.su.se/index.TEST01.html">FunCoup v.1-LE (requires Java)</a></P>
<P style="width:34%;"><a href="http://funcoup.sbc.su.se/search/">FunCoup v.4.0 </a></P>

<P style="width:33%;text-align:right;">Found problems? <A href="mailto:andrej.alekseenko@scilifelab.se">Send us email</A></P>

<script>
$(document).ready(function(){
	$(function() {
		$( "#showScales" ).dialog({
			resizable: false,
			modal: false,
			title: "Drug sensitivity scales", 
			width:  600,
			height: "auto",
			autoOpen: false,
			show: {
				effect: "blind",
				duration: 280
			},
			hide: {
				effect: "explode",
				duration: 600
			},
			buttons: {"Close": 
				function () {
					$(this).dialog("close");
				}
			}
		});
		$( "#ssOpener" ).click(function() {
			$( "#showScales" ).dialog( "open" );
			$( "#ssAcc" ).accordion();
		});
	});
	urlfixtabs("#tabs");
	$("#progressbar").progressbar({
		value: false
	});
	$("#progressbar").css({"visibility": "hidden"});
	$("#tabs").tabs({});
	// hide "Plots" tab by default
	$($("#tabs").find("li")[3]).hide()
	
	var screens = drug_sources();
	var options = [];
	options.push("<option value='all'>All screens</option>");
	for (i in screens) {
		options.push("<option value='" + screens[i].code + "'>" + screens[i].name +"</option>");
	}
	$("#screenList").append(options.join("")).selectmenu();
	
	var drugs = drug_list();
	//$("#compoundsList").menu();
	//for (i in drugs) {
	//	 $("<li><a href='#'>"+drugs[i].source+"</a></li>").appendTo("#compoundsList");
	//	 console.log(drugs[i].source);
    //  $("#compoundsList").menu("refresh");
	//}
	options = [];
	$("#compoundsList").append("<option value='all'>All compounds</option>").selectmenu();
	for (i in drugs) {
		for (j in drugs[i].drugs) {
			options.push("<option value='" + drugs[i].drugs[j] + "'>"+ drugs[i].drugs[j] +"</option>")
		}
		$("#compoundsList").append('<optgroup label="' + drugs[i].source + '">' + options.join("") + '</optgroup>').selectmenu();
	}
	
	var features = feature_list();
	options = [];
	$("#featuresList").append("<option value='all'>All features</option>").selectmenu();
	for (i in features) {
		for (j in features[i].codes) {
			options.push("<option value='"+ features[i].codes[j] + "'>" + features[i].names[j] + "</option>");
		}
		$("#featuresList").append('<optgroup label="'+ features[i].feature + '">' + options.join("") + '</optgroup>').selectmenu();
	}	
		
	$("#submit-populate").button();
});

function plot(type) {
	document.getElementById("tab-plot").innerHTML = "This tab is supposed to show " + type + " plot";
}

function retrieve_correlations() {
	var screen = $("#screenList option:selected").val();
	var compound = $("#compoundsList option:selected").val();
	var feature = $("#featuresList option:selected").val();
	console.log(screen + " " + compound + " " + feature);
	retreive_drug_correlations(screen, compound, feature);
}
</script>
</BODY>
</HTML>
	
