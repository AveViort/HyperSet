<!DOCTYPE html>
<!--!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"-->
<HTML lang="en-US">
<HEAD>
<TITLE>HyperSet: network enrichment analysis</TITLE>
<meta http-equiv="content-type" content="charset=utf-8">
<META http-equiv="Content-Script-Type" content="application/javascript" >
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/HyperSet/hyperset.css" type="text/css" rel="stylesheet">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/js/qTip/jquery.qtip.min.css" type="text/css" rel="stylesheet">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/pics/favicon.ico" rel="shortcut icon">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-ui-themes-1.10.4/themes/cupertino/jquery-ui.min.css" type="text/css" rel="stylesheet">
<link href="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/jquery.cytoscape.js-panzoom.css" rel="stylesheet" type="text/css" />
<link href="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/font-awesome-4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css" />
<!--script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script-->
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape-cytoscape.js-panzoom-c1dbe79/jquery.cytoscape.js-panzoom.js"></script>

<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-2.0.3.min.js" 
type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-ui-1.10.4/js/jquery-ui-1.10.4.min.js" type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery.form.js" type="text/javascript"></script>  
<script src="http://funcoup2.sbc.su.se/js/overlib.js" type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/qTip/jquery.qtip.min.js"></script>
<script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>  
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/arbor.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape.js-qtip-master/jquery.cytoscape.js-qtip.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/jquery.cytoscape.js-cxtmenu.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape.js-edgehandles.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/FileSaver.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Blob.js"></script>

<script  type="text/javascript"> 
 
function saveCy  () {
var filename = $('[name="saveCyViewFileName"]').val();
if ((filename.length - filename.toUpperCase().indexOf(".PNG")) != 4) {
filename = filename + ".png";
}
var b64 = cy.png();
var byteString = atob(b64.split(',')[1]);
var mimeString = b64.split(',')[0].split(':')[1].split(';')[0]
    var ab = new ArrayBuffer(byteString.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }
saveAs(new Blob([ab], {type: "image/png"}), filename);
}

function saveCy2 () {
//alert("dd");
var filename = $('[name="submit-save-cy-json2"]').val();
if ((filename.length - filename.toUpperCase().indexOf(".CYJSON")) != 7) {
filename = filename + ".cyjson";
}

var Js = [JSON.stringify(cy.json())];
var blob = new Blob(Js, {type: "application/json"});
saveAs(blob, filename);
}

function saveCy3 () {
var filename = $('[name="input-save-cy-json3"]').val();
if ((filename.length - filename.toUpperCase().indexOf(".CYJSON")) != 7) {
filename = filename + ".cyjson";
}
alert("Save the file " + filename + " in the project space");
}

 function setInputType(Tab, CallerTag)  {
$("[id*='-" + Tab + "-ele']").prop("disabled", true);
$("[id*='" + CallerTag + "-" + Tab + "-ele']").prop("disabled", false);
}

function showSubmit() {
$('[class*="-ags-controls"]').css("visibility", "visible");
}

function suppressele(Ele)  {
$("[name='" + Ele + "']").prop("checked", false);
$("[name='" + Ele + "']").prop("disabled", true);
}

function prepareresort (Href) {
//alert(Href);
var Params = Href.split(";");
for (i = 0; i<Params.length; i++) {
var Content = Params[i].split("=");
$("[name='" + Content[0] + "']").val(Content[1]);
}
//fdr=0.05000;project_id=HYPERSET.pr;neafile=currentNEA;step=resort;sortdirection=dn;sortkey=AGS
}

function updatechecksbm(Type, Content)  {
//alert(Type + " " + Content);
var New;
if (Content == "List of gene/protein IDs") {
if (Type == "ags") {
var List = $("[name='sgs_list']").val();
} else {
var List = $("[name='cpw_list']").val();
}
List = List.replace(/\r\n/g,', ');
List = List.replace(/\s/g,', ');
New = List;
if (List.length > 120) {
New =  Content;
$("[name='sbm-selected-" + Type + "']").prop("title", List);
//alert(New.length);
} else {
New = List;
$("[name='sbm-selected-" + Type + "']").prop("title", "");
}
$("[name='sbm-selected-" + Type + "']").prop("size", New.length + 3);
$("[name='sbm-selected-" + Type + "']").val(New);
} else {
New = "";
$("[name='" + Type.toUpperCase() + "selector']").each(
function() {
if ($(this).prop("checked")) {
if (New == "") {
New = $(this).val();
} else {
New = New + ' & ' + $(this).val();
}}
});
if (New.length > 120) {
$("[name='sbm-selected-" + Type + "']").prop("size", 25);
$("[name='sbm-selected-" + Type + "']").prop("title", New);
$("[name='sbm-selected-" + Type + "']").val("List of multiple items");
//alert(New.length);
} else {
$("[name='sbm-selected-" + Type + "']").prop("size", New.length + 5);
$("[name='sbm-selected-" + Type + "']").val(New);
$("[name='sbm-selected-" + Type + "']").prop("title", "");
}
}
$("[name='sbm-selected-" + Type + "']").prop("readOnly", true);
}

HSTabs = new Object(); 
HSTabs.indices = new Array(); 
HSTabs.names = ["Network enrichment", "Driver mutations", "Venn space", "Driver mutations0"];
for (var i=0; i<HSTabs.names.length; i++) {
HSTabs.indices[HSTabs.names[i]] = i; 
}
HSTabs.subtab = new Object(); 
HSTabs.subtab.names = new Array(); 
HSTabs.subtab.indices = new Array(); 
HSTabs.subtab.names[0] = "Altered gene sets";
HSTabs.subtab.names[1] = "Network";
HSTabs.subtab.names[2] = "Functional gene sets";
HSTabs.subtab.names[3] = "Check and submit";
HSTabs.subtab.names[4] = "Results";
for (var i=0; i<HSTabs.subtab.names.length; i++) {
HSTabs.subtab.indices[HSTabs.subtab.names[i]] = i; 
}

function writeHref() { //writes href into the AJAX-loaded tabs, such as "FGS" and "Networks". It is  dynamic in the sense it responds to changes of species and project ID.
$('#' + analysisType + " a[  href^='cgi/inputMenu.cgi']").each( 
function() {
var ProtoHref = $(this).attr("href");
var Mark = "?type=";
var Pos = ProtoHref.indexOf(Mark);
var Type = ProtoHref[(Pos + Mark.length)] + ProtoHref[(Pos + Mark.length + 1)] + ProtoHref[(Pos + Mark.length + 2)];
var Href = 'cgi/inputMenu.cgi?type=' + Type + ';species=' + Species + ';analysis_type=' + analysisID + ';project_id=' + document.getElementById(Project_field).value;
 $(this).attr("href", Href);
});
}


var HSonReady;
var pressedButton;		
var ProjectID;
var analysisType;

		$(document).ready(
				HSonReady = function () { 		
 //MASTER FUNCTION: http://malsup.com/jquery/form/ 
		// return true;
var options = { 
       //target:        '#vs_out',   // target element(s) to be updated with server response 
        beforeSubmit:  showRequest,  // pre-submit callback 
        success:       showResponsea,  // post-submit callback 
        forceSync: true
		//data: { formstat: 3 }
		//url:       url         // override for form's 'action' attribute 
        //type:      type        // 'get' or 'post', override for form's 'method' attribute 
        //dataType:  null        // 'xml', 'script', or 'json' (expected server response type) 
        //clearForm: true        // clear all form fields after successful submit 
        //resetForm: true        // reset the form after successful submit 
        // $.ajax options can be used here too, for example: 
        //timeout:   3000 
    };
	// Analysis Tabs (such as NEA, Venn space, driver analysis etc.) and their code are meant to be as uniform and recyclable as possible. 
	// Each such tab must contain a separate form with multiple "submit" buttons, e.g. in sub-tabs AGS, FGS, "check and submit".
	// On the other hand, names of input elements should be identical between different tabs. This can lead to confusion, as same value might be read from multiple elements.
 //The general rule is:
 // IDs of 1) the current project and 2) of analysis Tab must be unique. 
 // All other HTML elements in the forms should be recurrently used. Potential ambiguities should be resolved via jQuery selectors with following check in a loop:
$("form").ajaxForm(options);
 
//$(function() {$('[id="agsSubmit"]').click(
$(function() {$(':submit').click(
function () {
  //alert(this.id); 
 $("#action").val(this.id);
 pressedButton = $("#action").val(); 
 //alert($(this).attr("class"));
 if ($(this).attr("class") == "arrowbutton") {
 pressedButton = 'arrowbutton';
 //alert(pressedButton);
 }
 }); });  
 

$(function() { // to be executed first, when the web page have just loaded
$("div.main_ajax_menu").each(
function() {
analysisType = $(this).attr("id");
//alert(analysisType);
analysisID = analysisType[analysisType.length-2]+analysisType[analysisType.length-1];
Project_field = 'project_id_' + analysisID;
Species  = $('#' + analysisType + ' select[name="species"]').val();
OldProjectID = document.getElementById(Project_field).value;
writeHref();
})
}); 

$(function() {$('div[id="tabs"]').click(
	function() {
var href = $("li.ui-state-active a:first-child").attr("href");	
var ind = href.indexOf("=");
analysisType = href.substring(ind + 1, href.length);
writeHref();
					});});

$(function() {$('select[name="species"]').change(
	function() {
Species = $(this).val();	
writeHref();
	});
});

$(function() {$('input[id="project_id_ne"]').change(
	function() {
	ProjectID = $(this).val();	
alert("Note: the project ID as of now: " + ProjectID + ". (Old project ID: " + OldProjectID + ")" + analysisType + " " + analysisID);

OldProjectID = ProjectID;
writeHref();
var Tag = $('#' + analysisType + ' select[name="species"]').val() + "_" + analysisID;
$("#collapsable_list_ags_files_" + Tag).empty();
$("#collapsable_" + Tag + "_").empty();
/*$("#button_list_ags_files_" + Tag).remove();
$("#button_" + Tag + "_").remove();
$('div[id="' + analysisType + '"]').tabs( "load", HSTabs.subtab.indices["Altered gene sets"]); */
					});});
					
$(function() {$('div[id*="analysis_type_"]').click(
	function() {
$("[id*='hidinp']").val($(this).tabs("option", "active"));
analysisType = $(this).attr("id");
analysisID = analysisType[analysisType.length-2]+analysisType[analysisType.length-1];
Project_field = 'project_id_' + analysisID;
writeHref();
}); });

$(function() {$('div[id*="analysis_type_dm"]').click(
	function() {
var tabTypes = {0 : "sgs", 2 : "cpw"};
$("#cpw_vs_sgs").val(tabTypes[$(this).tabs( "option", "active" )]);
actualGeneCol = "gene_column_id_" + tabTypes[$(this).tabs( "option", "active" )];
$("#gene_column_id_dm").val(document.getElementsByName(actualGeneCol).value);
}); });
}); 
//#######################################

	function showRequest(formData, jqForm, options) { // http://malsup.com/jquery/form/ :
	var queryString = $.param(formData); 
//alert('About to submit: \n' + queryString); 
    var formID = jqForm.attr('id');
	var analysisID = formID[formID.length-2]+formID[formID.length-1];
	divID = "analysis_type_"+analysisID;
//alert("Pressed: " + pressedButton);	

if (pressedButton == "submit-save-cy-json") {
	options.target='#project_files'; //'+analysisID+'
	}
	
if (pressedButton == "agssubmitbutton-table-ags-ele") {
	options.target='#ags_select'; //'+analysisID+'
	}

if (pressedButton == "sbmSubmit") {
	options.target='#ne_out'; //'+analysisID+'
	}

if (pressedButton == "arrowbutton") {
	options.target='#nea_table'; //'+analysisID+'
	}

if (pressedButton == "listbutton-table-ags-ele") {
	options.target='#list_ags_files'; //'+analysisID+'
	}
if (pressedButton == "deletebutton-table-ags-ele") {
	options.target='#list_ags_files'; //'+analysisID+'
	}

if (options.target.indexOf("_out") > 0) {
$('div[id=' + divID + ']').tabs( "option", "active", HSTabs.subtab.indices["Results"] );
}
$('div[id=' + divID + ']').tabs( "load", HSTabs.subtab.indices ["Check and submit"] );
    $('#load').addClass("loading"); 
//alert('About to submit: \n\n' + divID + '; TARGET:' + options.target + ' , ' + queryString); 
// here we could return false to prevent the form from being submitted; 
    return true; 
} 
 
// post-submit callback 
function showResponsea(responseText, statusText, xhr, form)  { // http://malsup.com/jquery/form/
	$('#load').removeClass("loading");
	    //$(function() {        $("#tabs").tabs();    });  // <- might be needed here because in Venn space (when ajax_target[0] = "#ags_select3") JS complains that tabs() are not found. But still does not work...
    /*$(function() {
if ( $('div[id="' + analysisType + '"]').tabs( "option", "active" ) == 
		HSTabs.subtab.indices["Check and submit"]) { //tabs() is from jquery-ui.js
	$('div[id="' + analysisType + '"]').tabs( "option", "active", HSTabs.subtab.indices["Results"]); 
	}});*/
} 
    </script> 
    <script   type="text/javascript"> 

$(function() {        $("#tabs").tabs({
  beforeLoad: function( event, ui ) {
    if ( ui.tab.data( "loaded" ) ) {
      event.preventDefault();
      return;  
    }

    ui.jqXHR.success(function() {
      ui.tab.data( "loaded", true );
    });
  }
});    });

	$(function() {	
		$('div[id*="analysis_type_"]').tabs({ // from jquery-ui.js

beforeLoad: function( event, ui ) {
    if ( ui.tab.data( "loaded" ) ) {
      event.preventDefault();
      return;
    }
ui.jqXHR.error(function() {
	ui.panel.html('Couldn\'t load this tab. We\'ll try to fix this as soon as possible. Please inform <a href="mailto:andrej.alekseenko@scilifelab.se?subject=HyperSet website bug">andrej.alekseenko@scilifelab.se</a>...');
}); 
ui.jqXHR.success(function() {
    ui.tab.data( "loaded", true );
});
}  }); });
	$(function() {$(document).tooltip();});
    </script>
</HEAD>
  <BODY class="ui-state-default ui-corner-all">
<div id="load" class="modal"></div>
          <H1 class="title">HyperSet: network analysis made practical</H1>

		  <div id="tabs">
    <ul>
	<!-- CHANGE THE ORDER IN HSTabs.indices RESPECTIVELY: -->
       <!--li><a href="#analysis_type_ne1">NEA & GSEA</a></li-->
       <li><a href="cgi/inputMenu.cgi?tab_id=analysis_type_ne">Network enrichment analysis</a></li>
       <li><a href="#analysis_type_vs">Venn space</a></li>
       <!--li><a href="cgi/inputMenu.cgi?tab_id=analysis_type_dm">Driver mutations and disease genes</a></li-->
		<li  class="todo"><a href="#analysis_type_dm0" style="color: #999999;">Driver mutation analysis</a></li>
       <li class="todo"><a href="#analysis_type_pw" style="color: #999999;">Do my genes relate to each other?</a></li>
            <!--li class="todo"><a href="#analysis_type_tr" style="color: #999999;">How transcriptome alterations relate to "non-transcriptional" pathways?</a></li>
        <li><a href="#analysis_type_ae" style="color: #999999;">How different high-throughput platform data relate to each other?</a></li>
        <li><a href="#analysis_type_cs" style="color: #999999;">Chip-Seq</a></li>
        <li><a href="#analysis_type_pc" style="color: #999999;">Prioritize candidate genes</a></li>
        <!--li><a href="#analysis_type_gs" style="color: #999999;">Network-constrained gene signatures</a></li-->
    </ul>
<HR>
                 <!--UL>
					<LI class="todo"><A href="">My tasks</A></LI>
					<LI class="todo"><A href="">My account</A></LI>
                    <LI class="todo"><A href=""> About</A></LI>
                    <LI class="todo"><A href=""> Documentation</A></LI>
                    <LI class="todo"><A href=""> Tutorial</A></LI>
				</UL-->
 <!--###################################################START VS-->
				  <div id="analysis_type_vs" class="normal_menu vs" >
				  <FORM id="form_vs" action="cgi/inputMenu.cgi" method="POST" enctype="multipart/form-data" autocomplete="on">
		  		<input type="hidden" name="action" id="action" />		                       <table><tr><td>Project ID&nbsp;<INPUT maxlength="100" type="text"  name="project_id" id="project_id_vs" size="30" value="HYPERSET.venn"></td><td></td>
<td>
Organism: <select name="species">
<option value="hsa" selected="selected">human</option>
<option value="mmu">M. musculus</option>
<option value="ath">A. thaliana</option>
</select>
</td></tr></table>
				  				      <ul>
        <li><a href="#dynamic_tb">Dynamic Venn space</a></li>
        <li><a href="#precalc_tb">Altered gene sets</a></li>
		 <!--li><a href="http://research.scilifelab.se:3838">Dynamic Venn space</a></li-->
        <li><a href="cgi/inputMenu.cgi?type=net">Network</a></li>
        <li><a href="cgi/inputMenu.cgi?type=fgs">Functional gene sets</a></li>
		<li><a href="cgi/inputMenu.cgi?type=sbm">Check and submit</a></li>
        <li><a href="#vs_out">Results</a></li>
    </ul>
<div name="analysisStep" id="dynamic_tb"  class="analysis_step_area">
<iframe src="http://research.scilifelab.se:3838" sandbox="allow-top-navigation allow-same-origin allow-scripts allow-forms" width="1200" height="900"></iframe> 
<!--img class="clickmap" src="http://research.scilifelab.se/andrej_alexeyenko/pics/venn_map_3.gif"-->
</div>
<div name="analysisStep" id="precalc_tb"  class="analysis_step_area">
<input type="hidden" name="analysis_type" value="vs">
<input type="hidden" name="type"           value="precalc"> 								
Submit gene lists with pre-calculated fold change values&nbsp;&nbsp;&nbsp;
					<br>			
<TABLE>
                    <TR><td style="vertical-align: top;">
					Upload a file:<br>
		<INPUT type="file" name="de_table" size="10" class="ui-widget-header ui-corner-all">
<br><br>
<button type="submit" class="ui-widget-header ui-corner-all" id="agsSubmit">Submit</button	>
					</td>             </TR></TABLE>
					<br>
				<div id="ags_select2">ags_select2
				</div>
				<div id="ags_select3">ags_select3
				</div>
				</div>
				<div id="vs_out" name="analysisStep" ></div>
</FORM>			
</div>

<!--#END VS##################################################-->
              <!--FORM action="http://tools.scilifelab.se/hyperset/login" method="GET"><BUTTON type="submit"><IMG width="16" alt="login" src="http://tools.scilifelab.se/adhoc/static/login.png" title="login" height="16">Login</BUTTON><INPUT type="hidden" name="href" value="http://tools.scilifelab.se/hyperset/blastn"></FORM-->   
        <P style="width:34%;">HyperSet v0.01</P>
        <!--P style="width:33%; text-align:center;"><A href="http://tools.scilifelab.se/">SciLifeLab tools</A></P-->
        <P style="width:33%;text-align:right;"><A href="mailto:andrej.alekseenko@scilifelab.se">Send us email</A></P>

    </BODY></HTML>
	