<!DOCTYPE html>
<!--!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"-->
<HTML lang="en-US">
<HEAD>
<TITLE>HyperSet: network enrichment analysis</TITLE>
<meta http-equiv="content-type" content="charset=utf-8">
<META http-equiv="Content-Script-Type" content="application/javascript" >
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/HyperSet/hyperset.css" type="text/css" rel="stylesheet">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/js/qTip/jquery.qtip.min.css" type="text/css" rel="stylesheet">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/pics/favicon.ico" rel="shortcut icon">
<LINK href="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-ui-themes-1.10.4/themes/cupertino/jquery-ui.min.css" type="text/css" rel="stylesheet">
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-2.0.3.min.js" 
type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery-ui-1.10.4/js/jquery-ui-1.10.4.min.js" 
type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/jquery.form.js" 
type="text/javascript"></script>  
<script src="http://funcoup2.sbc.su.se/js/overlib.js" type="text/javascript"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/qTip/jquery.qtip.min.js"></script>
<script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>  
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/arbor.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/cytoscape.js-qtip-master/jquery.cytoscape.js-qtip.js"></script>
<script src="http://research.scilifelab.se/andrej_alexeyenko/js/Cytoscape.js/jquery.cytoscape.js-cxtmenu.js"></script>

<script  type="text/javascript"> 
HSTabs = new Object(); 
HSTabs.indices = new Array(); 
HSTabs.names = ["Network enrichment", "Driver mutations", "Venn space"];
for (var i=0; i<HSTabs.names.length; i++) {
HSTabs.indices[HSTabs.names[i]] = i; 
}
HSTabs.subtab = new Object(); 
HSTabs.subtab.names = new Array(); 
HSTabs.subtab.indices = new Array(); 
HSTabs.subtab.names[0] = "Altered gene sets";
HSTabs.subtab.names[1] = "Network";
HSTabs.subtab.names[2] = "Functional gene sets";
HSTabs.subtab.names[3] = "Check and submit";
HSTabs.subtab.names[4] = "Results";
for (var i=0; i<HSTabs.subtab.names.length; i++) {
HSTabs.subtab.indices[HSTabs.subtab.names[i]] = i; 
}

//alert(HSTabs.sections.length);	
		 function writeHref() { //writes href into the AJAX-loaded tabs, such as "FGS" and "Networks". It is  dynamic because it should respond to changes of species and project ID.
alert(analysisType);
	   $('#' + analysisType + " a[href^='cgi/inputMenu.cgi']").each( 
function() {
var ProtoHref = $(this).attr("href");
var Mark = "?type=";
var Pos = ProtoHref.indexOf(Mark);
var Type = ProtoHref[(Pos + Mark.length)] + ProtoHref[(Pos + Mark.length + 1)] + ProtoHref[(Pos + Mark.length + 2)];
var Href = 'cgi/inputMenu.cgi?type=' + Type + ';species=' + Species + ';analysis_type=' + analysisID + ';project_id=' + document.getElementById(Project_field).value;
 $(this).attr("href", Href);
 //alert(Href);
 })}

		$(document).ready(function() { 		//MASTER FUNCTION, http://malsup.com/jquery/form/ :
// $(function firstHandler() { //	$(document).firstHandler();		
		// return true;
var options = { 
       //target:        '#vs_out',   // target element(s) to be updated with server response 
        beforeSubmit:  showRequest,  // pre-submit callback 
        success:       showResponsea,  // post-submit callback 
        forceSync: true
		//data: { formstat: 3 }
		//url:       url         // override for form's 'action' attribute 
        //type:      type        // 'get' or 'post', override for form's 'method' attribute 
        //dataType:  null        // 'xml', 'script', or 'json' (expected server response type) 
        //clearForm: true        // clear all form fields after successful submit 
        //resetForm: true        // reset the form after successful submit 
        // $.ajax options can be used here too, for example: 
        //timeout:   3000 
    };
	// 
	// Analysis Tabs (such as NEA, Venn space, driver analysis etc.) and their code are meant to be as uniform and recyclable as possible. 
	// Each such tab must contain a separate form with multiple "submit" buttons, e.g. in sub-tabs AGS, FGS, "check and submit".
	// On the other hand, names of input elements should be identical between different tabs. This can lead to confusion, as same value might be read from multiple elements.
 //The general rule is:
 // IDs of 1) the current project and 2) of analysis Tab must be unique. 
 // All other HTML elements in the forms should be recurrently used. Potential ambiguities should be resolved via jQuery selectors with the following check in a loop:
 //alert("Target:" + options.target);
$("form").ajaxForm(options); 
//});
$(function() {$('div[id="tabs"]').click(function() {});});

$(function() { // to be executed first, when the page have just loaded
analysisType = $("div.normal_menu:first").attr("id");
analysisID = analysisType[analysisType.length-2]+analysisType[analysisType.length-1];
Project_field = 'project_id_' + analysisID;
Species  = $('#' + analysisType + ' select[name="species"]').val();
OldProjectID = document.getElementById(Project_field).value;
writeHref();
}); 
// On tab click:

	   $(function() {$('select[name="species"]').change(
		function() {
Species = $(this).val();
writeHref();
	})
 //); 
 					});
	   //all <li> descendants of <div>, ID of which equals  analysisType
//var ProtoHref = $('#ajax1').attr("href");

	$(function() {$('input[id*="project_id_"]').change(
		function() {
		
	ProjectID = $(this).val();	
	alert("Child of: " + this.parent() + ". Note: project ID is redefined from now on: " + ProjectID + ". The old project ID was: " + OldProjectID);
	OldProjectID = ProjectID;
writeHref();
					})});
					
	   $(function() {
		$('div[id*="analysis_type_"]').click(
		function() {
$("[id*='hidinp']").val($(this).tabs("option", "active"));
		analysisType = $(this).attr("id");
$("#" + analysisType + " select").each(function() {});
analysisID = analysisType[analysisType.length-2]+analysisType[analysisType.length-1];
Project_field = 'project_id_' + analysisID;

if (analysisType == "analysis_type_dm") { 
	   var tabTypes = {0 : "sgs", 2 : "cpw"};
$("#cpw_vs_sgs").val(tabTypes[$(this).tabs( "option", "active" )]);
actualGeneCol = "gene_column_id_" + tabTypes[$(this).tabs( "option", "active" )];
$("#gene_column_id_dm").val(document.getElementsByName(actualGeneCol).value);
}
writeHref();
})});
}); 

	function showRequest(formData, jqForm, options) { // http://malsup.com/jquery/form/ :
	var queryString = $.param(formData); 
    var formID = jqForm.attr('id');
	var analysisID = formID[formID.length-2]+formID[formID.length-1];
	divID = "analysis_type_"+analysisID;

if ($('div[id="analysis_type_ne"]').tabs( "option", "active" ) == HSTabs.subtab.indices["Altered gene sets"]) { //HSTabs.subtab.indices["Altered gene sets"]
	options.target='#ags_select';
} else {
	options.target='#'+analysisID+'_out';
	}
var ajax_target=new Array();
ajax_target[HSTabs.subtab.indices["Check and submit"]] = '#'+analysisID+'_out';

if ($('div[id="tabs"]').tabs("option", "active") == HSTabs.indices["Venn space"]) { //for Venn space HSTabs.indices["Venn space"]
if (document.getElementById("precalc_vs") && document.getElementById("precalc_vs").value == "vs") {
ajax_target[HSTabs.subtab.indices["Altered gene sets"]] = "#ags_select3"; // last step: take  conditions for the Venn space and retrieve satisfying genes
} else {
ajax_target[HSTabs.subtab.indices["Altered gene sets"]] = "#ags_select2"; //upload the precalculated table and generate condition table 
	}}
	
if ($('div[id="tabs"]').tabs( "option", "active" ) == HSTabs.indices["Network enrichment"]) { //for NEA & GSEA
//alert('About to submit: ags_select_dm');
ajax_target[HSTabs.subtab.indices["Altered gene sets"]] = "#ags_select"; 
	} 
if ($('div[id="tabs"]').tabs( "option", "active" ) == HSTabs.indices["Driver mutations"]) { //for driver mutations
if ($('div[id="analysis_type_dm"]').tabs( "option", "active" ) == HSTabs.subtab.indices["Functional gene sets"]) { 
ajax_target[HSTabs.subtab.indices["Functional gene sets"]] = "#cpw_select"; 
} else {
ajax_target[HSTabs.subtab.indices["Altered gene sets"]] = "#ags_select_dm"; 
}
} 
options.target = ajax_target[$('div[id=' + divID + ']').tabs( "option", "active" )] 
    $('#load').addClass("loading"); 
//alert('About to submit: \n\n' + ajax_target[0] + ' ' + divID + '; TARGET:' + options.target + ' , ' + queryString); 
// here we could return false to prevent the form from being submitted; 
    return true; 
} 
 
 
// post-submit callback 
function showResponsea(responseText, statusText, xhr, form)  { // http://malsup.com/jquery/form/ :
//  alert('status: ' + statusText + '\n\nresponseText: \n' + responseText + '\n\nThe output div should have already been updated with the responseText.'); 
	$('#load').removeClass("loading");
	    $(function() {        $("#tabs").tabs();    });  // <- might be needed here because in Venn space (when ajax_target[0] = "#ags_select3") JS complains that tabs() are not found. But still does not work...
//alert($('div[id="' + analysisType + '"]').attr("id"));	
    $(function() {
if ( $('div[id="' + analysisType + '"]').tabs( "option", "active" ) == HSTabs.subtab.indices["Check and submit"]) { //tabs() is from jquery-ui.js
	$('div[id="' + analysisType + '"]').tabs( "option", "active", HSTabs.subtab.indices["Results"]); 
	}     });
} 
    </script> 
    <script   type="text/javascript"> 
	<!-- functions related to jquery-ui.js -->
    $(function() {
        $("#tabs").tabs();
    });
	$(function() {	
		$('div[id*="analysis_type_"]').tabs({ // from jquery-ui.js
beforeLoad: function( event, ui ) {
ui.jqXHR.error(function() {
	ui.panel.html('Couldn\'t load this tab. We\'ll try to fix this as soon as possible. Please inform <a href="mailto:andrej.alekseenko@scilifelab.se?subject=HyperSet website bug">andrej.alekseenko@scilifelab.se</a>...');
});
} 
});
});
	$(function() {
		$(document).tooltip();
	});
    </script>
</HEAD>
  <BODY class="ui-state-default ui-corner-all">
<div id="load" class="modal"></div>
          <H1 class="title">HyperSet: network analysis made practical</H1>

		  <div id="tabs">
    <ul>
        <!--li><a href="#analysis_type_ne">NEA & GSEA</a></li-->
         <li><a href="cgi/inputMenu.cgi?tab_id=analysis_type_ne">NEA & GSEA</a></li>
         <li><a href="#analysis_type_dm">Driver mutation analysis</a></li>
         <li><a href="#analysis_type_vs">Venn space</a></li>
         <li class="todo"><a href="#analysis_type_pw" style="color: #999999;">Do my genes relate to each other?</a></li>
         <li class="todo"><a href="#analysis_type_tr" style="color: #999999;">How transcriptome alterations relate to "non-transcriptional" pathways?</a></li>
         <li><a href="#analysis_type_ae" style="color: #999999;">How different high-throughput platform data relate to each other?</a></li>
         <li><a href="#analysis_type_cs" style="color: #999999;">Chip-Seq</a></li>
         <li><a href="#analysis_type_pc" style="color: #999999;">Prioritize candidate genes</a></li>
        <!--li><a href="#analysis_type_gs" style="color: #999999;">Network-constrained gene signatures</a></li-->
    </ul>

<!--###################################################START VS-->
				  <div id="analysis_type_vs" class="normal_menu vs" >
				  <FORM id="form_vs" action="cgi/inputMenu.cgi" method="POST" enctype="multipart/form-data" autocomplete="on">
		  				                       <table><tr><td>Project ID&nbsp;<INPUT maxlength="100" type="text"  name="project_id" id="project_id_vs" size="30" value="HYPERSET.venn"></td><td></td>
<td>
Organism: <select name="species">
<option value="hsa" selected="selected">human</option>
<option value="mmu">M. musculus</option>
<option value="ath">A. thaliana</option>
</select>
</td></tr></table>
				  				      <ul>
        <li><a href="#precalc_tb">Altered gene sets</a></li>
        <li><a href="#dynamic_tb">Dynamic Venn space</a></li>
        <li><a href="cgi/inputMenu.cgi?type=net">Network</a></li>
        <li><a href="cgi/inputMenu.cgi?type=fgs">Functional gene sets</a></li>
		<li><a href="cgi/inputMenu.cgi?type=sbm">Check and submit</a></li>
        <li><a href="#vs_out">Results</a></li>
    </ul>
<div name="analysisStep" id="dynamic_tb"  class="analysis_step_area">
<iframe src="http://research.scilifelab.se:3838" sandbox="allow-top-navigation allow-same-origin allow-scripts allow-forms" width="1000" height="700"></iframe> 
<img class="clickmap" src="http://research.scilifelab.se/andrej_alexeyenko/pics/venn_map_3.gif">
</div>
<div name="analysisStep" id="precalc_tb"  class="analysis_step_area">
<input type="hidden" name="analysis_type" value="vs">
<input type="hidden" name="type"           value="precalc"> 								
Submit gene lists with pre-calculated fold change values&nbsp;&nbsp;&nbsp;
					<br>			
<TABLE>
                    <TR><td style="vertical-align: top;">
					Upload a file:<br>
		<INPUT type="file" name="de_table" size="10" class="ui-widget-header ui-corner-all">
<br><br>
<button type="submit" class="ui-widget-header ui-corner-all" id="agsSubmit">Submit</button	>
					</td>             </TR></TABLE>
					<br>
				<div id="ags_select2">ags_select2
				</div>
				<div id="ags_select3">ags_select3
				</div>
				</div>
				<div id="vs_out" name="analysisStep" ></div>
</FORM>			
</div>

<!--#END VS##################################################-->
<!--###################################################START DM-->
<div id="analysis_type_dm"  class="normal_menu dm" >
				  <FORM id="form_dm"  action="cgi/inputMenu.cgi" method="POST" enctype="multipart/form-data" autocomplete="on" >
		  				                      <table ><tr><td>Project ID&nbsp;<INPUT maxlength="100" type="text"  name="project_id" id="project_id_dm" size="30" value="HYPERSET.mut"></td><td></td>
<td>
Organism: <select name="species">
<option value="hsa" selected="selected">human</option>
<option value="mmu">M. musculus</option>
<option value="ath">A. thaliana</option>
</select>
</td></tr></table>


				      <ul>
        <li><a href="#sgs_tb">Candidate disease genes</a></li>
        <li><a href="cgi/inputMenu.cgi?type=net">Network</a></li>
        <li><a href="#cpw_tb">Functional gene sets</a></li>
        <li><a href="cgi/inputMenu.cgi?type=sbm">Check and submit</a></li>
        <li><a href="#dm_out">Results</a></li>
    </ul>
<div name="formstatdiv" id="hiddiv"  class="hidden">
<input type="hidden" id="hidinp_dm"  name="formstat" value="default">
</div>
<input type="hidden" name="analysis_type" value="dm">
<input type="hidden" name="type"   id="cpw_vs_sgs" value="sgs"> 								
<input type="hidden" name="gene_column_id"   id="gene_column_id_dm"        value="1"> 								
<div name="analysisStep" id="cpw_tb"  class="analysis_step_area">
Submit gene/protein list:&nbsp;&nbsp;&nbsp;
						<TABLE>
                    <TR>                      
<td style="vertical-align: top;">Upload a file:</td>
<td style="vertical-align: top;">or paste a list as a single group:</td>
<td style="vertical-align: top;">and/or use our collection of cancer pathways:</td>
<td style="vertical-align: top;">and/or use our collection of other disease pathways:</td>
                   </tr>
				   <TR>                      
<td style="vertical-align: top;">
<INPUT maxlength="200" type="file" name="cpw_table" size="10" class="ui-widget-header ui-corner-all">
<br>
Gene/protein in col.&nbsp;<INPUT maxlength="2" type="text" name="gene_column_id_cpw" size="1" value="1">
<br>
Group in col.&nbsp;<INPUT maxlength="2" type="text" name="group_column_id" size="1" value="3">
<br>
File is&nbsp; <select name="delimiter">
<option value="tab" selected="selected">TAB</option>
<option value="comma">comma</option>
<option value="space">space</option>
</select>&nbsp;delimited.
</td>
<td style="vertical-align: top;">
<TEXTAREA rows="10" name="cpw_list" cols="20"></TEXTAREA>
</td>
<td style="vertical-align: top;">
<input name="cpw_collection" type="checkbox" value="cpw_collection">
</td>
<td style="vertical-align: top;">
<input name="oth_collection" type="checkbox" value="oth_collection">
</td>
				</TR>
					</TABLE>
<button type="submit" class="ui-widget-header ui-corner-all" id="cpwSubmit">Submit</button	>
				<div id="cpw_select">
				cpw table
				</div>
				</div>
<div name="analysisStep" id="sgs_tb"  class="analysis_step_area">
Submit gene/protein list:&nbsp;&nbsp;&nbsp;
<TABLE>
                    <TR>                      
<td style="vertical-align: top;">Upload a file:</td>
<td style="vertical-align: top;">or paste a list:</td>
                   </tr>
                    <TR>                      
					<td style="vertical-align: top;">
					<INPUT maxlength="200" type="file" name="sgs_table" size="10" class="ui-widget-header ui-corner-all">
<br>
<br>
Gene/protein&nbsp;IDs&nbsp;in&nbsp;col.&nbsp;<INPUT maxlength="2" type="text" name="gene_column_id_sgs" size="1" value="1">
<br>
File is <select name="delimiter">
<option value="tab" selected="selected">TAB</option>
<option value="comma">comma</option>
<option value="space">space</option>
</select>&nbsp;delimited.
<br><br>
<button type="submit" class="ui-widget-header ui-corner-all" id="agsSubmit">Submit</button	>
					</td>
					<td style="vertical-align: top;">
        <TEXTAREA rows="10" name="sgs_list" cols="20"></TEXTAREA> <!--disabled="disabled" -->
					</td>
                    </TR>
					</TABLE>
				<div id="ags_select_dm">ags_select_dm
				
				</div>
				</div>
			<div id="dm_out" name="analysisStep" ></div>
					 <br>
		</FORM>
</div>
<!--#END DM##################################################-->
<!--###################################################START AE-->
				  <div id="analysis_type_ae"  class="normal_menu ne" >
				  <FORM id="form_ae"  action="cgi/inputMenu.cgi" method="POST" enctype="multipart/form-data" autocomplete="on" >
				      <ul>
        <li><a href="#ags_tb2">Altered gene sets</a></li>
        <li><a href="cgi/inputMenu.cgi?species=hsa;analysis_type=ne;type=net">Network</a></li>
         <li><a href="cgi/inputMenu.cgi?species=hsa;analysis_type=ne;type=sbm">Checklist</a></li>
         <li><a href="#ne_out_ae">Results</a></li>
    </ul>

<div name="analysisStep" id="ags_tb2"  class="analysis_step_area">
Submit two groups of gene/protein lists from different platforms:&nbsp;&nbsp;&nbsp;
<input type="hidden" name="analysis_type" value="ae">
<input type="hidden" name="type"           value="ags"> 								
<TABLE><TR><TD>Platform 1</TD><TD>Platform 2</TD></TR><Tr><TD>
<TABLE>
                    <TR title="Specify table columns that contain gene/protein IDs and group IDs">                      
					<td style="vertical-align: top;">
					Upload a file:<br>
		<INPUT maxlength="200" type="file" name="ags_table1" size="10" class="ui-widget-header ui-corner-all">
<br>
<br>
Gene/protein&nbsp;in&nbsp;col.&nbsp;<INPUT maxlength="2" type="text" name="gene_column_id" size="1" value="1">
<br>
Group&nbsp;in&nbsp;col.&nbsp;<INPUT maxlength="2" type="text" name="group_column_id" size="1" value="3">
<br>
File is <select name="delimiter">
<option value="tab" selected="selected">TAB</option>
<option value="comma">comma</option>
<option value="space">space</option>
</select>&nbsp;delimited.

					</td>
					<td>
					or paste a list (one group):
					<br>
        <TEXTAREA  rows="10" name="sgs_list1" cols="20"></TEXTAREA>
					</td>
                    </TR>
					</TABLE>
					</td><td>
<TABLE>
                    <TR title="Specify table columns that contain gene/protein IDs and group IDs">                      
					<td style="vertical-align: top;">
					Upload a file:<br>
		<INPUT maxlength="200" type="file" name="ags_table2" size="10" class="ui-widget-header ui-corner-all">
<br>
<br>
Gene/protein&nbsp;in&nbsp;col.&nbsp;<INPUT maxlength="2" type="text" name="gene_column_id" size="1" value="1">
<br>
Group&nbsp;in&nbsp;col.&nbsp;<INPUT maxlength="2" type="text" name="group_column_id" size="1" value="2">
<br>
File is <select name="delimiter">
<option value="tab" selected="selected">TAB</option>
<option value="comma">comma</option>
<option value="space">space</option>
</select>&nbsp;delimited.

					</td>
					<td>
					or paste a list (one group):
					<br>
					
        <TEXTAREA rows="10" name="sgs_list2" cols="20"></TEXTAREA>
					</td>
                    </TR>
					</TABLE>
					</td></TR></TABLE>
						<button type="submit" class="ui-widget-header ui-corner-all" id="agsSubmit">Submit</button	>
				<div id="ags_select_ae">
				
				</div>
				</div>
										</FORM>
</div>				  
<!--######################################## END AE-->
<HR>
                 <UL>
					<LI class="todo"><A href="">My tasks</A></LI>
					<LI class="todo"><A href="">My account</A></LI>
                    <LI class="todo"><A href=""> About</A></LI>
                    <LI class="todo"><A href=""> Documentation</A></LI>
                    <LI class="todo"><A href=""> Tutorial</A></LI>
				</UL>
               <!--FORM action="http://tools.scilifelab.se/hyperset/login" method="GET"><BUTTON type="submit"><IMG width="16" alt="login" src="http://tools.scilifelab.se/adhoc/static/login.png" title="login" height="16">Login</BUTTON><INPUT type="hidden" name="href" value="http://tools.scilifelab.se/hyperset/blastn"></FORM-->   
        <P style="width:34%;">HyperSet v0.01</P>
        <!--P style="width:33%; text-align:center;"><A href="http://tools.scilifelab.se/">SciLifeLab tools</A></P-->
        <P style="width:33%;text-align:right;"><A href="mailto:andrej.alekseenko@scilifelab.se">Send us email</A></P>

    </BODY></HTML>
	